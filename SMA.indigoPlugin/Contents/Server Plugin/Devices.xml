<?xml version="1.0"?>
<Devices>
    <Device type="custom" id="smaIndigoInverter">
        <Name>Solar Inverter</Name>
        <States>
        	<State id="serialNumber">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Serial Number</TriggerLabel>
        		<ControlPageLabel>Serial Number</ControlPageLabel>
        	</State>
        	<State id="acPower">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>AC Power</TriggerLabel>
        		<ControlPageLabel>AC Power</ControlPageLabel>
        	</State>
        	<State id="acApparentPower">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>AC Apparent Power</TriggerLabel>
        		<ControlPageLabel>AC Apparent Power</ControlPageLabel>
        	</State>
        	<State id="acCurrent">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>AC Current</TriggerLabel>
        		<ControlPageLabel>AC Current</ControlPageLabel>
        	</State>
        	<State id="acVoltage">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>AC Voltage</TriggerLabel>
        		<ControlPageLabel>AC Voltage</ControlPageLabel>
        	</State>
        	<State id="gridFreq">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Grid Frequency</TriggerLabel>
        		<ControlPageLabel>Grid Frequency</ControlPageLabel>
        	</State>
        	<State id="dcPower">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>DC Power</TriggerLabel>
        		<ControlPageLabel>DC Power</ControlPageLabel>
        	</State>
        	<State id="dcInputVoltage">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>DC Input Voltage</TriggerLabel>
        		<ControlPageLabel>DC Input Voltage</ControlPageLabel>
        	</State>
        	<State id="deviceTemperature">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Device Temperature</TriggerLabel>
        		<ControlPageLabel>Device Temperature</ControlPageLabel>
        	</State>
        	<State id="dailyYield">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Daily Yield</TriggerLabel>
        		<ControlPageLabel>Daily Yield</ControlPageLabel>
        	</State>
        	<State id="totalYield">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Total Yield</TriggerLabel>
        		<ControlPageLabel>Total Yield</ControlPageLabel>
        	</State>
        	<State id="totalOperationTime">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Operation Time</TriggerLabel>
        		<ControlPageLabel>Operation Time</ControlPageLabel>
        	</State>
        	<State id="feedInTime">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Feed-in Time</TriggerLabel>
        		<ControlPageLabel>Feed-in Time</ControlPageLabel>
        	</State>
        	<State id="intermediateVoltage">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Intermediate Voltage</TriggerLabel>
        		<ControlPageLabel>Intermediate Voltage</ControlPageLabel>
        	</State>
        	<State id="isolationResistance">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Isolation Resistance</TriggerLabel>
        		<ControlPageLabel>Isolation Resistance</ControlPageLabel>
        	</State>
        	<State id="totalEnergyFromGrid">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Energy From Grid</TriggerLabel>
        		<ControlPageLabel>Total Energy From Grid</ControlPageLabel>
        	</State>
        	<State id="totalEnergyToGrid">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Energy To Grid</TriggerLabel>
        		<ControlPageLabel>Total Energy To Grid</ControlPageLabel>
        	</State>
        	<State id="powerFromGrid">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Power From Grid</TriggerLabel>
        		<ControlPageLabel>Power From Grid</ControlPageLabel>
        	</State>
        	<State id="powerToGrid">
        		<ValueType>Number</ValueType>
        		<TriggerLabel>Power To Grid</TriggerLabel>
        		<ControlPageLabel>Power To Grid</ControlPageLabel>
        	</State>
        </States>
        
        <ConfigUI>
            <Field id="inverterAddress" type="textfield">
                <Label>Inverter Address: </Label>
            </Field>
            <Field id="inverterPort" type="textfield" default="502">
                <Label>Inverter Port: </Label>
            </Field>
        </ConfigUI>
    </Device>

	<Device type="custom" id="smaIndigoAggregation">
		<Name>Aggregation</Name>
		<States>
			<State id="value">
				<ValueType>Number</ValueType>
				<TriggerLabel>Value</TriggerLabel>
				<ControlPageLabel>Value</ControlPageLabel>
			</State>
		</States>

		<ConfigUI>
			<Field id="aggregationType" type="menu" defaultValue="inverterList">
				<Label>Aggregation Type: </Label>
				<List>
					<Option value="inverterList">Inverter List</Option>
					<Option value="aggregationList">Aggregation List</Option>
					<Option value="aggregationToAggregation">Aggregation to aggregation</Option>
					<Option value="inverterToInverter">Inverter to inverter</Option>
				</List>
			</Field>
			<Field id="sep1" type="separator"/>


			<!-- Inverter List -->
			<Field id="inverterList" type="list" visibleBindingId="aggregationType" visibleBindingValue="inverterList">
				<Label>Inverter List: </Label>
				<List class="indigo.devices" filter="self.smaIndigoInverter"/>
			</Field>

			<Field id="inverterListState" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterList">
				<Label>Inverter State: </Label>
				<List class="self" method="get_available_inverter_states"/>
			</Field>

			<Field id="inverterListOperation" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterList">
				<Label>Operation: </Label>
				<List>
					<Option value="sum">Sum</Option>
					<Option value="average">Average</Option>
				</List>
			</Field>


			<!-- Aggregation List -->
			<Field id="aggregationList" type="list" visibleBindingId="aggregationType" visibleBindingValue="aggregationList">
				<Label>Aggregation List</Label>
				<List class="indigo.devices" filter="self.smaIndigoAggregation"/>
			</Field>

			<Field id="aggregationListOperation" type="menu" visibleBindingId="aggregationType" visibleBindingValue="aggregationList">
				<Label>Operation: </Label>
				<List>
					<Option value="sum">Sum</Option>
					<Option value="average">Average</Option>
				</List>
			</Field>


			<!-- Inverter to Inverter -->
			<Field id="inverterToInverter_Inverter1" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterToInverter">
				<Label>First Inverter</Label>
				<List class="indigo.devices" filter="self.smaIndigoInverter"/>
			</Field>

			<Field id="inverterToInverter_Inverter1State" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterToInverter">
				<Label>State: </Label>
				<List class="self" method="get_available_inverter_states"/>
			</Field>

			<Field id="inverterToInverter_Inverter2" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterToInverter">
				<Label>Second Inverter</Label>
				<List class="indigo.devices" filter="self.smaIndigoInverter"/>
			</Field>

			<Field id="inverterToInverter_Inverter2State" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterToInverter">
				<Label>State: </Label>
				<List class="self" method="get_available_inverter_states"/>
			</Field>

			<Field id="inverterToInverterOperation" type="menu" visibleBindingId="aggregationType" visibleBindingValue="inverterToInverter">
				<Label>Operation: </Label>
				<List>
					<Option value="sum">Sum</Option>
					<Option value="subtraction">Subtraction</Option>
					<Option value="division">Average</Option>
					<Option value="multiplication">Multiplication</Option>
					<Option value="average">Average</Option>
					<Option value="min">Min</Option>
					<Option value="max">Max</Option>
				</List>
			</Field>


			<!-- Aggregation to Aggregation -->
			<Field id="aggregationToAggregation_Aggregation1" type="menu" visibleBindingId="aggregationType" visibleBindingValue="aggregationToAggregation">
				<Label>First Aggregation: </Label>
				<List class="indigo.devices" filter="self.smaIndigoAggregation"/>
			</Field>

			<Field id="aggregationToAggregation_Aggregation2" type="menu" visibleBindingId="aggregationType" visibleBindingValue="aggregationToAggregation">
				<Label>Second Aggregation: </Label>
				<List class="indigo.devices" filter="self.smaIndigoAggregation"/>
			</Field>

			<Field id="aggregationToAggregationOperation" type="menu" visibleBindingId="aggregationType" visibleBindingValue="aggregationToAggregation">
				<Label>Operation: </Label>
				<List>
					<Option value="sum">Sum</Option>
					<Option value="subtraction">Subtraction</Option>
					<Option value="division">Average</Option>
					<Option value="multiplication">Multiplication</Option>
					<Option value="average">Average</Option>
					<Option value="min">Min</Option>
					<Option value="max">Max</Option>
				</List>
			</Field>

		</ConfigUI>
	</Device>

</Devices>
